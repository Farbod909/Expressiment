<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Users</title>
  <link rel="stylesheet" href="css/index.css" type="text/css">
  <script type="text/javascript" src="js/main.js"></script>
</head>

<body>
  <a href="/">home</a> | <a href="about">about</a> | <a href="users">users</a>

  <span id="logged-in-info" class="hidden">
    <a href="#" class="logout-btn">Log Out</a>
    <span class="user-display">Logged in as: <span id="username-display"></span></span>
  </span>
  <span id="logged-out-info" class="hidden">
    <a href="login">login</a>
  </span>

  <h2>This is the users page</h2>


  <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="js/main.js"></script>
  <script>
    $(document).ready(function() {
      $.post("/f/getUsers", function(responseText) {
        var users = JSON.parse(responseText);
        var table = document.createElement("table");
        var th0 = document.createElement("th");
        var th1 = document.createElement("th");
        var th2 = document.createElement("th");
        th0.innerHTML = "#";
        th1.innerHTML = "First Name"
        th2.innerHTML = "Last Name"
        table.appendChild(th0);
        table.appendChild(th1);
        table.appendChild(th2);
        for (var i = 0; i < users.length; i++) {
          var tr = document.createElement("tr");
          var td0 = document.createElement("td");
          var td1 = document.createElement("td");
          var td2 = document.createElement("td");
          var td3 = document.createElement("td");
          td0.innerHTML = i + 1;
          td1.innerHTML = users[i].firstname;
          td2.innerHTML = users[i].lastname;
          td3.innerHTML = "Delete"
          $(td3).addClass("delete-col");
          tr.appendChild(td0);
          tr.appendChild(td1);
          tr.appendChild(td2);
          tr.appendChild(td3);
          $(tr).attr("data-userid", users[i].id);
          $(table).attr("id", "users-table")
          table.appendChild(tr);
        }
        document.body.appendChild(table);

        $(".delete-col").click(function() {
          var row = $(this).parent();
          $.post("/f/deleteUser", JSON.stringify({
            id: $(this).parent().attr("data-userid")
          }), function(responseText) {
            if (responseText == "success") {
              row.remove();
            } else {
              alert("fail");
            }
          });
        })
      })
    })
  </script>
</body>

</html>
