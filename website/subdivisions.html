
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Subdivisions</title>
  <link rel="stylesheet" href="css/index.css" type="text/css">
  <script type="text/javascript" src="js/main.js"></script>
</head>

<body>
  <a href="/">home</a> | <a href="users">users</a> | <a href="subdivisions">subdivisions</a>

  <span id="logged-in-info" class="hidden">
    <a href="#" class="logout-btn">Log Out</a>
    <span class="user-display">Logged in as: <span id="username-display"></span></span>
  </span>
  <span id="logged-out-info" class="hidden">
    <a href="login">login</a>
  </span>

  <h2>Make a subdivision</h2>
  <input type="text" id="subdivision-name-text" placeholder="subdivision name"><br/>
  <select id="public-private-select">
    <option value="public">public</option>
    <option value="public">private</option>
  </select><br/><br/>
  <div id="users-table-div"></div><br/>
  <input type="button" id="create-subdivision-btn" value="create">

  <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="js/main.js"></script>
  <script>
    $(document).ready(function() {
      var teams = JSON.parse(localStorage.teams);
      $.post("/f/getUsersInTeam", {team_id: teams[0]}, function(responseText) {
        var users = JSON.parse(responseText);
        var table = document.createElement("table");
        var th0 = document.createElement("th");
        var th1 = document.createElement("th");
        var th2 = document.createElement("th");
        th0.innerHTML = "#";
        th1.innerHTML = "First Name"
        th2.innerHTML = "Last Name"
        table.appendChild(th0);
        table.appendChild(th1);
        table.appendChild(th2);
        for (var i = 0; i < users.length; i++) {
          var tr = document.createElement("tr");
          var td0 = document.createElement("td");
          var td1 = document.createElement("td");
          var td2 = document.createElement("td");
          var td3 = document.createElement("td");
          td0.innerHTML = i + 1;
          td1.innerHTML = users[i].firstname;
          td2.innerHTML = users[i].lastname;
          td3.innerHTML = "Invite"
          $(td3).addClass("invite-col");
          tr.appendChild(td0);
          tr.appendChild(td1);
          tr.appendChild(td2);
          tr.appendChild(td3);
          $(tr).attr("data-userid", users[i].id);
          $(table).attr("id", "users-table")
          table.appendChild(tr);
        }
        document.getElementById("users-table-div").appendChild(table);
      });
      var selectedUsers = []
      $(document).on("click", ".invite-col", function() {
        var row = $(this).parent();
        if( $(this).hasClass("selected") ){
          selectedUsers.splice( selectedUsers.indexOf( row.attr("data-userid") ), 1 );
          $(this).removeClass("selected");
        }else{
          selectedUsers.push(row.attr("data-userid"));
          $(this).addClass("selected");
        }
      });
      $(document).on("click", "#create-subdivision-btn", function() {
        var subdivisionType = $("#public-private-select").val();
        $.post("/f/createSubdivision", {name: $("#subdivision-name-text").val(), type: subdivisionType, team_id: localStorage.c_team}, function(responseText){
          if(responseText != "fail"){
            for(var i=0; i<selectedUsers.length; i++){
              $.post("/f/inviteToSubdivision", {user_id: selectedUsers[i], team_id: localStorage.c_team, subdivision_id: responseText}, function(responseText){
                if(responseText == "success"){
                  console.log("invited");
                }else{
                  alert("fail");
                }
              });
            }
          }else{
            alert("failed to create");
          }
        });
      });
    });
  </script>
</body>

</html>
