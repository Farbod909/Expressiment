<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=0.7, user-scalable=no" />
  <title>MorTeam</title>
  <meta name="description" content="The Standard Robotics Management Platform. Communicate with teammmates using team-wide and subdivision-specific announcements, chats, group drives, calendar events, attendance, and more.">
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Exo+2:400,300,200' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="css/index.css" type="text/css">
</head>

<body>
  <a id="back_to_login" href="login">Back to login</a>
  <div id="signup_area">
    <div id="form">
      <!-- <div class="col-lg-6 col-sm-6 col-xs-6"> -->
      <form style="text-align: center;" id="signup_form" enctype="multipart/form-data" action="/f/createUser" method="post">
        <input class="signup_item" type="text" placeholder="First Name" id="firstname" name="firstname"></input>
        <input class="signup_item" type="text" placeholder="Last Name" id="lastname" name="lastname"></input>
        <input class="signup_item" type="text" placeholder="Username" id="username_signup" name="username"></input>
        <input class="signup_item" type="password" placeholder="Password" id="password_signup" name="password"></input>
        <input class="signup_item" type="password" placeholder="Confirm Password" id="password_signup_confirm" name="password_confirm"></input>
        <input class="signup_item" type="email" placeholder="Email" id="email_signup" name="email"></input>
        <input class="signup_item" type="text" placeholder="Phone Number" id="phone_signup" name="phone"></input>
        <input type="file" name="profpic" class="hidden show_files" id="show_files" accept="image/*" />
        <input type="button" class="pic_choose_button signup_item" value="Choose Profile Picture">
        <input class="signup_item" type="submit" value="Submit" id="signup_buttonS"></input>
      </form>
    </div>
  </div>

  <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="/js/jquery.form.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/main.js"></script>
  <script>
  String.prototype.capitalize = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
  }
  function validateEmail(email) {
    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
    return re.test(email);
  }
  function validatePhone(phone){
    return phone.match(/\d/g).length===10;
  }
  $(document).ready(function(){
    // $("#signup_buttonS").click(function() {
    //   if($("#password_signup").val() == $("#password_signup_confirm").val()){
    //     $.post("/f/createUser", {
    //       "id": Math.floor(Math.random() * (100000000000 - 10000000000)) + 10000000000,
    //       "username": $("#username_signup").val(),
    //       "password": $("#password_signup").val(),
    //       "firstname": $("#firstname").val(),
    //       "lastname": $("#lastname").val(),
    //       "email": $("#email_signup").val(),
    //       "phone": $("#phone_signup").val(),
    //       // "profpic": document.getElementById("file").files[0] //DOES NOT WORK TODO: FIX THIS
    //     }, function(responseText) {
    //       if(responseText == "success"){
    //         location="/login";
    //       }else if(responseText == "exists"){
    //         alert("that username and/or email and/or phone number already exists");
    //       }else{
    //         alert("failed");
    //       }
    //     });
    //   }else{
    //     alert("passwords do not match");
    //   }
    // });

    $(".pic_choose_button").click(function(){
      $("#show_files").trigger("click");
    })
    $('#signup_form').submit(function(e) {
      $("#signup_buttonS").val("Loading");
      $("#signup_buttonS").prop("disabled",true);
      e.preventDefault();
      if(validatePhone($("#phone_signup").val())){
        if(validateEmail($("#email_signup").val())){

          $("#firstname").val( $.trim($("#firstname").val().capitalize()) );
          $("#lastname").val( $.trim($("#lastname").val().capitalize()) );
          $("#username_signup").val( $.trim($("#username_signup").val()) );
          $("#email_signup").val( $.trim($("#email_signup").val().replace(/[- )(]/g,'')) );
          $("#phone_signup").val( $.trim($("#phone_signup").val()) );

          $(this).ajaxSubmit({
              error: function(xhr) {
            		alert(xhr.status)
                $("#signup_buttonS").val("Submit");
                $("#signup_buttonS").prop("disabled",false);
              },
              success: function(response) {
                if(response == "success"){
				  if(location.search == "?mobileapp") {
					  alert("Success! You can now log in from the mobile app.");
					  location = "morscout://";
				  }
				  else if(location.search == "?offlineapp") {
					  alert("Success! You can now log in from the offline app.")
				  }
				  else {
                  	location="/login";
				  }
                }else{
                  alert(response);
                  $("#signup_buttonS").val("Submit");
                  $("#signup_buttonS").prop("disabled",false);
                }
              }
  	      });

        	return false;
        }else{
          alert("Email is invalid.");
          $("#signup_buttonS").val("Submit");
          $("#signup_buttonS").prop("disabled",false);
          return false;
        }
      }else{
        alert("Phone is invalid.");
        $("#signup_buttonS").val("Submit");
        $("#signup_buttonS").prop("disabled",false);
        return false;
      }
    });
  });
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67504156-1', 'auto');
  ga('send', 'pageview');

  </script>

</body>

</html>
