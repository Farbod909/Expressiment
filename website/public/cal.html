<!DOCTYPE html>
<html lang="en">

  <head>
  	<meta charset="utf-8" />
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>MorTeam - Calendar</title>
  	<link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Exo+2:400,300,200' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <script src="jbox/jBox.css"></script>
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link href="jbox/jBox.css" rel="stylesheet">
    <link href="/jbox/themes/TooltipDark.css" rel="stylesheet">
    <script src="js/spin.js"></script>
    <script type="text/javascript">
        var loadingDiv = document.createElement("div");
        loadingDiv.className = "loading_circle";
        loadingDiv.id = "loading_circle";
    </script>

  </head>
  <body class="cal_body">
      <div id="audio-files" style="display: none;">
          <audio id="click-sound">
              <source src="jbox/audio/bling2.wav" type="audio/wav" />
          </audio>
      </div>
    <!-- NAVIGATION BAR -->
    <div class="nav_dropdown">
      <p onclick="location='index'">Home</p>
      <p onclick="location='chat'">Chat</p>
      <p onclick="location='drive'">Drive</p>
      <p onclick="location='cal'" style="background-color: orange">Calendar</p>
      <p onclick="location='networks'">Networks</p>
    </div>
    <div class="navigation_bar">
        <ul id="navbar_list">
          <li class="navbar_item navbar_title" onclick="location='/'">
              MorTeam
          </li>
          <li class="navbar_item searchbox_list_item">
              <input type="text" placeholder="search" class="searchbox"></input>
              <div class="search_drop">
                <ul class="search_drop_items">

                </ul>
              </div>
          </li>
          <li class="navbar_item glyph_link chat_btn menu_btn" onclick="location='chat'">
              <span class="glyphicon glyphicon-comment"></span>
          </li>
          <li class="navbar_item glyph_link drive_btn menu_btn" onclick="location='drive'">
              <span class="glyphicon glyphicon-hdd"></span>
          </li>
          <li class="navbar_item glyph_link cal_btn menu_btn active" onclick="location='cal'">
              <span class="glyphicon glyphicon-calendar"></span>
          </li>
          <li class="navbar_item glyph_link networks_btn menu_btn" onclick="location='networks'">
              <span class="glyphicon glyphicon-globe"></span>
          </li>
          <li class="navbar_item glyph_link networks_btn menu_btn" onclick="location='http://www.scout.morteam.com'">
              <span class="glyphicon glyphicon-pencil"></span>
          </li>
          <div class="navbar_item right_links">
            <li class="navbar_item glyph_link menu">
                <span class="glyphicon glyphicon-menu-hamburger"></span>
            </li>
            <li class="navbar_item glyph_link" id="notif_button">
                <span class="glyphicon glyphicon-inbox"></span>
            </li>
            <img class="profile_id" id="small_prof_pic" src="./images/user.jpg"></img>
            <span class="profile_name" id="name_link"></span>
          </div>
        </ul>
    </div>
    <div id="notif_drop" class="hidden">
      <ul>
        <li class="notif_list_item">hey</li>
        <li class="notif_list_item">hi</li>
        <li class="notif_list_item">ho</li>
      </ul>
    </div>
    <div id="prof_drop" class="hidden">
      <ul>
        <li class="notif_list_item" id="view_prof_button">View Profile and Settings</li>
        <li class="notif_list_item" id="logout_button">Log Out</li>
      </ul>
    </div>
    <div id="darken" class="hidden"></div>
    <!-- END OF NAVIGATION BAR -->

    <!-- BODY -->
    <div class="wrapper cal_wrapper">
      <div class="container-fluid cal_container">
        <div class="row cal_row">
          <div class="timeline col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12" id="timeline">
            <div class="current_month_display">
              <!-- MONTH -->
            </div>
            <!-- <div class="day">
              <div class="day_of_month">28</div>
              <input type="button" class="add_event" value="+" title="Add Event"></input>
              <div class="day_content">
                <h4 class="day_name">Sunday</h4>
                <ul class="day_list">
                  <li>Programming meeting in 285</li>
                  <li>All newbies will take quiz</li>
                </ul>
              </div>
            </div> -->
          </div>
          <div class="cal_right col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <div class="events_overview">
              <h3 class="u_events_title">Upcoming Events</h3>
              <div class="events_container">
                <ul class="events_list upcoming_events">

                </ul>
              </div>
            </div>
            <div class="jobs_overview">
              <h3 class="u_events_title">&nbsp;Pending Tasks</h3>
              <div class="events_container">
                <ul class="events_list task_list">

                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- END OF BODY -->

    <!-- LEFTBAR -->
    <div class="leftbar">
      <ul>
        <li class="month_name year_select">
            <div class="btn-group year_dropdown">
                <button class="button dropdown-toggle" data-toggle="dropdown"><span class="selected_year"></span>
                    <span class="caret"></span>
                </button>
                <ul class="years dropdown-menu">
                </ul>
            </div>
            <!-- <span class="glyphicon glyphicon-th grid_layout"></span>
            <span class="glyphicon glyphicon-th-list list_layout"></span>  UN-COMMENT WHEN LIST LAYOUT IS READY   -->
        </li>
        <li class="month_name m1" data-month="1"><span id="make_group" class="glyphicon glyphicon-calendar"></span> January</li>
        <li class="month_name m2" data-month="2"><span id="make_group" class="glyphicon glyphicon-calendar"></span> February</li>
        <li class="month_name m3" data-month="3"><span id="make_group" class="glyphicon glyphicon-calendar"></span> March</li>
        <li class="month_name m4" data-month="4"><span id="make_group" class="glyphicon glyphicon-calendar"></span> April</li>
        <li class="month_name m5" data-month="5"><span id="make_group" class="glyphicon glyphicon-calendar"></span> May</li>
        <li class="month_name m6" data-month="6"><span id="make_group" class="glyphicon glyphicon-calendar"></span> June</li>
        <li class="month_name m7" data-month="7"><span id="make_group" class="glyphicon glyphicon-calendar"></span> July</li>
        <li class="month_name m8" data-month="8"><span id="make_group" class="glyphicon glyphicon-calendar"></span> August</li>
        <li class="month_name m9" data-month="9"><span id="make_group" class="glyphicon glyphicon-calendar"></span> September</li>
        <li class="month_name m10" data-month="10"><span id="make_group" class="glyphicon glyphicon-calendar"></span> October</li>
        <li class="month_name m11" data-month="11"><span id="make_group" class="glyphicon glyphicon-calendar"></span> November</li>
        <li class="month_name m12" data-month="12"><span id="make_group" class="glyphicon glyphicon-calendar"></span> December</li>
      </ul>
    </div>
    <span class="glyphicon glyphicon-chevron-left hide_leftbar"></span>
    <!-- END OF LEFTBAR -->


    <script type="text/javascript" src="js/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="jbox/jBox.min.js"></script>
    <script type="text/javascript" src="js/velocity.min.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript">

    var socket = io();
    var daysInWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    function messageNotification(title, content, chatid) {
      var newMessageNotice = new jBox('Notice', {
          attributes: {
              x: 'right',
              y: 'bottom'
          },
          theme: 'NoticeBorder',
          volume: 100,
          animation: {
              open: 'slide:bottom',
              close: 'slide:right'
          },
          content: content,
          maxWidth: 300,
          maxHeight: 105,
          title: title,
          closeOnClick: false,
          onOpen: function() {
              // $($(this)[0].content).attr("data-author", author._id);
              $($(this)[0].content).attr("data-chatid", chatid);
          }
      });
    };
    function showAttendance(title, event_id){
      var new_modal = new jBox('Modal', {
        width: 350,
        height: 373,
        title: title,
        onClose: function(){
          setTimeout(function(){
            attendance_modal.destroy(); //keyword "this" does not work. make sure to name the modal "attendance_modal".
          }, 100)
        }
      });
      $.post("/f/getEventAttendees", {event_id: event_id}, function(responseText){
        var span = document.createElement("span");
        var user_search = '<input type="text" placeholder="Search Names..." class="members_search" id="subdivision_members_search">';
        var select_all_link = '<a class="select_all_link">Select All</a>';
        var potential_members = document.createElement("div");
        $(potential_members).attr("id", "attendance_list");
        $(potential_members).addClass("potential_members");
        $(potential_members).addClass("tall");
        var save_btn = '<input type="button" data-eventid="'+event_id+'" id="save_attendance" class="button done_button" value="Save">'
        var attendees = JSON.parse(responseText);
        for(var i = 0; i < attendees.length; i++){
          var attendee = document.createElement("p");
          $(attendee).addClass("potential_member");
          $(attendee).addClass("attendee");
          $(attendee).attr("data-userid", attendees[i].user._id);
          $(attendee).html(attendees[i].user.firstname + " " + attendees[i].user.lastname);
          if(attendees[i].status == "present"){
            $(attendee).addClass("clicked");
          }else if (attendees[i].status == "excused") {
            $(attendee).addClass("excused");
          }else if (attendees[i].status == "tardy") {
            $(attendee).addClass("tardy");
          }
          $(potential_members).append(attendee);
        }
        $(span).append($(user_search));
        $(span).append("<br/>");
        $(span).append($(select_all_link));
        $(span).append("<br/>");
        $(span).append($(potential_members));
        $(span).append("<br/>");
        $(span).append($(save_btn));
        new_modal.setContent( $(span) );
        new_modal.open();
      })
      return new_modal;
    }
    function readableDate(datestr){
      var date = new Date(datestr);
      return months[date.getMonth()] + " " + date.getDate() + ", " + date.getFullYear();
    }
    function daysInMonth(month,year) {
      return new Date(year, month, 0).getDate();
    }
    function removeDuplicates(arr) {
      var seen = {};
      var out = [];
      var len = arr.length;
      var j = 0;
      for(var i = 0; i < len; i++) {
        var item = arr[i];
        if(seen[item] !== 1) {
          seen[item] = 1;
          out[j++] = item;
        }
       }
      return out;
    }
    function eventModal(title, date){
      var new_modal = new jBox('Modal', {
        width: 350,
        height: 495,
        title: title,
        onClose: function(){
          setTimeout(function(){
            event_modal.destroy();  //keyword "this" does not work. make sure to name the modal "event_modal".
          }, 100)
        }
      });
      var span = document.createElement("span");
      var event_name = '<input type="text" id="event_name" class="name_input" placeholder="Title">';
      var event_description = '<textarea class="event_description" placeholder="Description (Optional)"></textarea>';
      var entireTeamDiv = '<div><input id="entireTeam" type="checkbox"> Invite Everyone</div>'
      var hasAttendanceDiv = '<div><input id="hasAttendance" type="checkbox" checked> Take Attendance?</div>'
      var sendEmailDiv = '<div><input id="sendEmail" type="checkbox" checked> Send Email?</div>'
      var user_search = '<input type="text" placeholder="Search Names..." class="members_search" id="event_members_search">';
      var potential_members = document.createElement("div");
      $(potential_members).attr("id", "potential_attendance_members");
      $(potential_members).addClass("potential_members");
      var done_btn = '<input data-date="'+ date +'" type="button" id="event_done_btn" class="button done_button" value="Done">'
      $.ajax({
        type: 'POST',
        url: "/f/getAllSubdivisionsForUserInTeam",
        async: false,
        success: function(responseText){
          var subdivisions = JSON.parse(responseText);
          for(var i = 0; i < subdivisions.length; i++){
            var subdivision = document.createElement("p");
            $(subdivision).addClass("potential_subdivision");
            $(subdivision).attr("data-subdivisionid", subdivisions[i]._id);
            $(subdivision).html(subdivisions[i].name);
            $(potential_members).append(subdivision);
          }

        }
      });
      $.post("/f/getUsersInTeam", function(responseText){
        var users = JSON.parse(responseText);
        for(var i = 0; i < users.length; i++){
          var user = document.createElement("p");
          $(user).addClass("potential_member");
          $(user).attr("data-userid", users[i]._id);
          $(user).html(users[i].firstname + " " + users[i].lastname);
          $(potential_members).append(user);
          if(users[i]._id == localStorage._id){
            $(user).addClass("clicked");
            $(user).addClass("hidden");
          }
        }
        $(span).append($(event_name));
        $(span).append("<br/>");
        $(span).append($(event_description));
        $(span).append("<br/>");
        $(span).append("Please select the attendees:");
        $(span).append("<br/>");
        $(span).append($(entireTeamDiv));
        $(span).append($(hasAttendanceDiv));
        $(span).append($(sendEmailDiv));
        $(span).append($(user_search));
        $(span).append("<br/>");
        $(span).append($(potential_members));
        $(span).append("<br/>");
        $(span).append($(done_btn));
        new_modal.setContent( $(span) );
        new_modal.open();
      })
      return new_modal;
    }


      $(document).ready(function(){
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var today = now.getDate();

        $.post("/f/getUpcomingEventsForUser", function(responseText){
          var upcomingEvents = JSON.parse(responseText);
          if(upcomingEvents.length > 0){
            for(var i = 0; i < upcomingEvents.length; i++){
              var li = document.createElement("li");
              $(li).html(upcomingEvents[i].name + " (" + readableDate(upcomingEvents[i].date) + ")");
              $(".upcoming_events").append( $(li) );
            }
          }else{
            $(".upcoming_events").append( "<li>none</li>" );
          }
        });

        $.post("/f/getPendingUserTasks", {user_id: localStorage._id}, function(responseText){
          if(responseText != "fail"){
            var tasks = JSON.parse(responseText);
            if(tasks.length > 0){
              for (var i = 0; i < tasks.length; i++) {
                var li = document.createElement("li");
                // $(li).html( tasks[i].name + " (By " + readableDate(tasks[i].due_date) + ")");
                $(li).html( tasks[i].name + " <span class='due_date_display'>(By " + readableDate(tasks[i].due_date) + ")</span> <span style='vertical-align: -5%; font-size: 14px' title='Assigned By "+ tasks[i].creator.firstname + " " + tasks[i].creator.lastname +"' class='assigned_by glyphicon glyphicon-info-sign'></span>");
                var div = document.createElement("div");
                $(div).addClass("indented");
                $(div).html(tasks[i].description);
                $(li).append("<br/>");
                $(li).append( $(div) );
                $(".task_list").append( $(li) );
              }
              $('.assigned_by').jBox('Tooltip', {
                  delayOpen: 0,
                  delayClose: 0,
                  theme: "TooltipDark"
              });
            }else{
              $(".task_list").append("<li>none</li>");
            }
          }else{
            alert(responseText);
          }
        })

        $(".selected_year").html( year );
        for( i=-1 ; i<5 ; i++){
          var year_li = document.createElement("li");
          $(year_li).addClass("year");
          $(year_li).html( now.getFullYear() + i )
          $(".years").append(year_li)
          if(i==0){
            $(year_li).addClass("selected");
          }
        }
        $(document).on("click", ".year", function(){
          $(".year").removeClass("selected");
          $(this).addClass("selected");
          $(".selected_year").html( $(this).html() );
          year = parseInt($(this).html());
          $(".month_name[data-month='"+month+"']").trigger("click");
        });

        $(".month_name:not(.year_select)").click(function(){
          $('.timeline').find('*').not('.current_month_display').remove();
          var $this = $(this);
          month = parseInt($this.attr("data-month"));
          $(".month_name").removeClass("selected");
          $(this).addClass("selected");
          $(".current_month_display").html( months[parseInt($this.attr("data-month"))-1] );
          for(var i = 1; i <= daysInMonth(parseInt($this.attr("data-month")), year); i++){
            var day_div = document.createElement("div");
            $(day_div).attr("data-day", i);
            $(day_div).addClass("day");
            var day_of_month = document.createElement("div");
            $(day_of_month).addClass("day_of_month");
            $(day_of_month).html(i);
            var day_content = document.createElement("div");
            $(day_content).addClass("day_content");
            $(day_div).append( $(day_of_month) );
            if(localStorage.c_team_position == "leader" || localStorage.c_team_position == "admin"){
              var add_event = document.createElement("input");
              $(add_event).attr("type", "button");
              $(add_event).addClass("add_event");
              $(add_event).attr("value", "+");
              $(add_event).attr("title", "Add Event");
              $(day_div).append( $(add_event) );
            }
            $(day_div).append( $(day_content) );
            var day_name = document.createElement("h4");
            $(day_name).addClass("day_name");
            $(day_name).html( daysInWeek[ new Date( year, parseInt($this.attr("data-month"))-1, i ).getDay() ] );
            var day_list = document.createElement("ul");
            $(day_list).addClass("day_list");
            $(day_list).attr("data-day", i);
            $(day_content).append( $(day_name) );
            $(day_content).append( $(day_list) );
            $(".timeline").append( $(day_div) );
          }
          if(month == now.getMonth()+1 && year == now.getFullYear()){
            $(".day[data-day='"+ today +"']").find(".day_content").addClass("today");
            var scrollPix = $(".day[data-day='"+ today +"']").offset().top - $(window).height()*0.5 + $(".day[data-day='"+ today +"']").height()*0.5;
            $('.timeline').scrollTop(scrollPix);
          }
          $.post("/f/getEventsForUserInTeamInMonth", {year: year, month: month}, function(responseText){
            if(responseText != "fail"){
              var events = responseText;
              for(var i = 0; i < events.length; i++){
                var day = new Date(events[i].date).getDate();
                var li = document.createElement("li");
                $(li).attr("data-eventid", events[i]._id);
                var event_name_display = document.createElement("span");
                $(event_name_display).addClass("bold");
                $(event_name_display).html(events[i].name);
                // TODO: add attendance and delete buttons
                var event_description_display = document.createElement("div");
                $(event_description_display).addClass("indented");
                $(event_description_display).html(events[i].description);
                $(li).append( $(event_name_display) );
                if(localStorage.c_team_position == "leader" || localStorage.c_team_position == "admin"){
                  var attendance_btn = '<span title="Record Attendance" class="glyphicon glyphicon-list-alt leaders_only attendance"></span>';
                  var delete_event_btn = '<span class="glyphicon glyphicon-trash list_right delete_event"></span>';
                  $(li).append(" ");
                  if( events[i].hasAttendance ){
                    $(li).append(attendance_btn);
                  }
                  $(li).append(delete_event_btn);
                }
                $(li).append( "<br/>" )
                $(li).append( $(event_description_display) );
                $(".day_list[data-day='"+ day +"']").append( $(li) );
              }
            }else{
              alert(responseText);
            }
          });
        });
        $(".month_name[data-month='"+month+"']").trigger("click"); //This has to be after the click event declaration for month_name

        $(document).on("click", ".add_event", function(){
          var $this = $(this);
          var newDate = new Date(year, month-1, $this.prev().html());
          event_modal = eventModal("New Event", newDate.toString());
        });

        $(document).on("change", "#entireTeam", function(){
          if( this.checked ){
            $('#potential_attendance_members').addClass("hidden");
            $('#potential_attendance_members > .clicked').removeClass("clicked");
          }else{
            $('#potential_attendance_members').removeClass("hidden");
          }
        })

        $(document).on("click", ".delete_event", function(){
          var $this = $(this);
          if (window.confirm("Are you sure?")) {
            $.post("/f/deleteEvent", {event_id: $this.parent().attr("data-eventid")}, function(responseText){
              if(responseText == "success"){
                $this.parent().remove();
              }else {
                alert(responseText)
              }
            })
          }
        });

        $(document).on("click", ".attendance", function(){
          attendance_modal = showAttendance("Attendance for " + $(this).prev().html(), $(this).parent().attr("data-eventid"));
        });
        updatedAttendees = [];
        $(document).on("click", "#save_attendance", function(){
          var p_attendees = $("#attendance_list > .potential_member");
          updatedAttendees.length = 0;
          for (var i = 0; i < p_attendees.length; i++) {
            if( $(p_attendees[i]).hasClass("clicked") ){
              updatedAttendees.push({
                user: $(p_attendees[i]).attr("data-userid"),
                status: "present"
              })
            }else if( $(p_attendees[i]).hasClass("excused") ){
              updatedAttendees.push({
                user: $(p_attendees[i]).attr("data-userid"),
                status: "excused"
              })
            }else if( $(p_attendees[i]).hasClass("tardy") ){
              updatedAttendees.push({
                user: $(p_attendees[i]).attr("data-userid"),
                status: "tardy"
              })
            }else{
              updatedAttendees.push({
                user: $(p_attendees[i]).attr("data-userid"),
                status: "absent"
              })
            }
          }
          $.post("/f/updateAttendanceForEvent", {event_id: $(this).attr("data-eventid"), updatedAttendees: updatedAttendees}, function(responseText){
            if(responseText == "success"){
              attendance_modal.close();
            }else{
              alert(responseText);
            }
          });
        });

        $(document).on("click", ".select_all_link", function() {
          if($(this).html() == "Select All"){
            $("#attendance_list > .potential_member").not(".excused").addClass("clicked");
            $(this).html("Deselect All")
          }else{
            $("#attendance_list > .potential_member").not(".excused").removeClass("clicked");
            $(this).html("Select All");
          }
        });


        $(document).on("click", "#event_done_btn", function(){
          if( $("#event_name").val() != "" ){
            var $this = $(this);
            var p_selected_users = $(".potential_member.clicked");
            var p_selected_subdivisions = $(".potential_subdivision.clicked");

            subdivisionAttendees = [];
            userAttendees = []

            for (var i = 0; i < p_selected_users.length; i++) {
              userAttendees.push($(p_selected_users[i]).attr("data-userid"));
            }
            for (var i = 0; i < p_selected_subdivisions.length; i++) {
              subdivisionAttendees.push($(p_selected_subdivisions[i]).attr("data-subdivisionid"));
            }
            if(removeDuplicates(userAttendees).length == 1 && subdivisionAttendees.length == 0){
              event_modal.close();
            }else{
              $.post("/f/createEvent", {
                name: normalizeDisplayedText( $("#event_name").val() ),
                description: normalizeDisplayedText( $(".event_description").val() ),
                userAttendees: userAttendees,
                subdivisionAttendees: subdivisionAttendees,
                date: $this.attr("data-date"),
                entireTeam: $('#entireTeam').is(':checked'),
                hasAttendance: $('#hasAttendance').is(':checked'),
                sendEmail: $('#sendEmail').is(':checked')
              }, function(responseText){
                event_modal.close();
                if(responseText != "fail"){
                  var newEvent = JSON.parse(responseText);
                  var li = document.createElement("li");
                  $(li).attr("data-eventid", newEvent._id);
                  var event_name_display = document.createElement("span");
                  $(event_name_display).addClass("bold");
                  $(event_name_display).html(newEvent.name);
                  // TODO: add attendance and delete buttons
                  var attendance_btn = '<span title="Record Attendance" class="glyphicon glyphicon-list-alt leaders_only attendance"></span>';
                  var delete_event_btn = '<span class="glyphicon glyphicon-trash list_right delete_event"></span>';
                  var event_description_display = document.createElement("div");
                  $(event_description_display).addClass("indented");
                  $(event_description_display).html(newEvent.description);
                  $(li).append( $(event_name_display) );
                  $(li).append( " " );
                  if( $('#hasAttendance').is(':checked') ){
                    $(li).append( attendance_btn );
                  }
                  $(li).append( delete_event_btn );
                  $(li).append( "<br/>" )
                  $(li).append( $(event_description_display) );


                  $(".day_list[data-day='"+ new Date($this.attr("data-date")).getDate() +"']").append( $(li) );
                }else{
                  alert(responseText);
                }
              });
            }
          }else{
            alert("You forgot to name the event");
          }
        });

        $(document).on("contextmenu", ".attendee", function(e){
          e.preventDefault();
          $(".drop").remove();
          var drop = $("<div class='drop' data-userid='"+$(this).attr("data-userid")+"'><li id='mark-present' class='drop_item'>Mark As Present</li><li id='mark-tardy' class='drop_item'>Mark as Tardy</li><li id='mark-excused' class='drop_item'>Mark As Excused</li></div>");
          drop.css("top", e.pageY);
          drop.css("left", e.pageX);
          $("body").append(drop);
          $(document).click(function(){
               $(".drop").remove();
               $(".chat_name:not(.make_group)").unbind("contextmenu");
          });
          return false;
        })
        $(document).on("click", "#mark-present", function(){
          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").removeClass("tardy");
          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").removeClass("excused");

          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").addClass("clicked");
        });
        $(document).on("click", "#mark-tardy", function(){
          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").removeClass("clicked");
          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").removeClass("excused");

          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").addClass("tardy");
        });
        $(document).on("click", "#mark-excused", function(){
          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").removeClass("tardy");
          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").removeClass("clicked");

          $(".attendee[data-userid='"+ $(this).parent().attr("data-userid") +"']").addClass("excused");
        });


        function hideLeftbar(time, button){
          $(".leftbar").velocity({left: "-260px"}, { duration: time, queue: false });
          $(".wrapper").velocity({left: "0px"}, { duration: time, queue: false });
          $(".wrapper").velocity({width: "100vw"}, { duration: time, queue: false });
          $(button).removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right");
          $(button).velocity({left: "10px"}, { duration: time, queue: false });
        }
        function showLeftbar(time, button){
          $(".leftbar").velocity({left: "0px"}, { duration: time, queue: false });
          $(".wrapper").velocity({left: "260px"}, { duration: time, queue: false });
          $(".wrapper").velocity({width: "-=260px"}, { duration: time, queue: false });
          $(button).removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left");
          $(button).velocity({left: "220px"}, { duration: time, queue: false });
          setTimeout(function(){
            $(".wrapper").css("width", "calc(100vw - 260px)");
          }, time + time)
        }
        $(".hide_leftbar").click(function(){
          if($(this).hasClass("glyphicon-chevron-left")){
            hideLeftbar(300, this);
          }else{
            showLeftbar(300, this);
          }
        });
        if($(window).width() < 825){
          hideLeftbar(0, ".hide_leftbar");
        }

        //general modal stuff
        $(document).on("click", ".potential_member", function(){
          if($(this).hasClass("clicked")){
            $(this).removeClass("clicked");
          }else if ($(this).hasClass("excused")) {
            if(window.confirm("Are you sure you want to mark this person as unexcused?")){
              $(this).removeClass("excused");
            }
          }else{
            $(this).addClass("clicked");
          }
        });
        $(document).on("click", ".potential_subdivision", function(){
          if($(this).hasClass("clicked")){
            $(this).removeClass("clicked");
          }else{
            $(this).addClass("clicked");
          }
        });
        $(document).on("keyup", '.members_search', function() {
          var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
          $('.potential_members p').show().filter(function() {
              var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
              console.log(!~text.indexOf(val));
              return !~text.indexOf(val);
          }).hide();
        });
        socket.on('message', function(msg){
          if(msg.type == "group"){
            messageNotification(msg.author_fn+" "+msg.author_ln+" in "+msg.chat_name, msg.content, msg.chat_id);
          }else{
            messageNotification(msg.author_fn+" "+msg.author_ln, msg.content, msg.chat_id);
          }
          $('#audio-files').find('audio#click-sound')[0].play();
          $('#audio-files').find('audio#click-sound')[0].currentTime = 0;
        })

      });
    </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67504156-1', 'auto');
  ga('send', 'pageview');

  </script>

  </body>
</html>
